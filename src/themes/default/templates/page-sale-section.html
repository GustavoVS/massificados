    {% extends 'base-sec.html' %}
{% load i18n %}
{# formset 1 #}
{% load bootstrap3 %}

{% block section-id %}page-sake-sec{% endblock %}

{% block section-title %}
    {% if buyer.pk %}
        {{ buyer }}
    {% else %}
        {% trans 'New Sale' %}
    {% endif %}
{% endblock %}

{% block section-content %}
    <form action="" method="post" class="form" enctype="multipart/form-data">
        {% csrf_token %}
        {% if productpk %}
            <input type="hidden" name="productpk" value="{{ productpk }}">
        {% endif %}
        <h3>{% trans 'Buyer' %}</h3>
        <div class="well">
            <div class="row">
                {% bootstrap_field form.name form_group_class='form-group col-md-4' %}
                {% bootstrap_field form.phone form_group_class='form-group col-md-4 mask-phone' %}
                {% bootstrap_field form.email form_group_class='form-group col-md-4' %}
                {% bootstrap_field form.kind_person form_group_class='form-group col-md-4 control-kind_person' %}

                {% bootstrap_field form.cpf_cnpj form_group_class='form-group col-md-4 kind_person-F hidden mask-cpf' %}
                {% bootstrap_field form.cpf_cnpj form_group_class='form-group col-md-4 kind_person-J hidden mask-cnpj' %}
                {# {% for field in form %} #}
                    {# {% bootstrap_field field form_group_class='form-group col-md-4' %} #}
                {# {% endfor %} #}
            </div>
        </div>
        <h3>{% trans 'Address' %}</h3>
        <div class="well">
            <div class="row">
                {{ addressbuyer.management_form }}
                {% bootstrap_field addressbuyer.0.postal_code form_group_class="form-group col-md-4 mask-cep cep-auto" %}
                {% bootstrap_field addressbuyer.0.street form_group_class="form-group col-md-4" %}
                {% bootstrap_field addressbuyer.0.district form_group_class="form-group col-md-4" %}
                {% bootstrap_field addressbuyer.0.city form_group_class="form-group col-md-4" %}
                {% bootstrap_field addressbuyer.0.state form_group_class="form-group col-md-4" %}
                {% bootstrap_field addressbuyer.0.number form_group_class="form-group col-md-4 mask-number" %}
                {% bootstrap_field addressbuyer.0.complement form_group_class="form-group col-md-4" %}
                {{ addressbuyer.0.id }}
                {{ addressbuyer.0.buyer }}
                {# {% for form in addressbuyer.forms %} #}
                    {# {% for field in form %} #}
                        {# {% bootstrap_field field form_group_class='form-group col-md-4' %} #}
                    {# {% endfor %} #}
                {# {% endfor %} #}
            </div>
        </div>
        {% if show_all %}
            <h3>{% trans 'Deadline' %}</h3>
            <div class="well">
                <div class="row">
                    {{ deadlinesale.management_form }}
                    {% bootstrap_field deadlinesale.0.begin form_group_class='form-group col-md-4 mask-date' %}
                    {% bootstrap_field deadlinesale.0.end form_group_class='form-group col-md-4  mask-date' %}
                    {% bootstrap_field deadlinesale.0.payment form_group_class='form-group col-md-4' %}
                    {% bootstrap_field deadlinesale.0.proposal form_group_class='form-group col-md-4' %}
                    {% bootstrap_field deadlinesale.0.policy form_group_class='form-group col-md-4' %}
                    {{ deadlinesale.0.id }}
                    {{ deadlinesale.0.sale }}

                    {% for question in questiondeadline %}
                        {% if question.type_data = 'input' or question.type_data = 'link' or question.type_data = 'float' or question.type_data = 'percent' or question.type_data = 'date' or question.type_data = 'number'%}
                            <div class="form-group col-md-{{ question.col_width|default:'4'}}{% if question.is_required %} form-required{% endif %}">
                                <label class="control-label" for="{{ q_name }}">
                                    {% if question.is_required %}
                                    <strong>{{ question.name }}</strong>
                                    {% else %}{{ question.name }}
                                    {% endif %}
                                </label>
                                <input type="{% if question.type_data = 'number' %}number{% else %}text{% endif %}" name="q_resp-{{ question.pk }}" id="q_resp-{{ question.pk }}"
                                       title="{{ question.hint }}"
                                       placeholder="{{ question.name }}"
                                       class="form-control mask-{{ question.type_data }}"
                                       value="{{ question.value|default_if_none:question.default_value }}"
                                       {% if question.is_required %}required{% endif %}>
                            </div>
                        {% elif question.type_data = 'checkbox' %}
                            <div class="form-group col-md-{{ question.col_width|default:'4'}}{% if question.is_required %} form-required{% endif %}">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" name="q_resp-{{ question.pk }}"
                                               title="{{ question.hint }}"
                                               placeholder="{{ question.name }}"
                                               id="q_resp-{{ question.pk }}">
                                    {% if question.is_required %}
                                        <strong>{{ question.name }}</strong>
                                    {% else %}{{ question.name }}
                                    {% endif %}

                                    </label>
                                </div>
                            </div>
                        {% elif question.type_data = 'select' %}
                            <div class="form-group col-md-{{ question.col_width|default:'4'}}{% if question.is_required %} form-required{% endif %}">
                                <label class="control-label" for="{{ q_name }}">
                                    {% if question.is_required %}
                                    <strong>{{ question.name }}</strong>
                                    {% else %}{{ question.name }}
                                    {% endif %}
                                </label>
                                <select title="{{ question.hint }}" class="form-control" name="q_resp-{{ question.pk }}"
                                        id="q_resp-{{ question.pk }}" {% if question.is_required %}required{% endif %}>
                                    <option value="">---------</option>
                                    {% for opt in question.domain_set.all %}
                                        <option value="{{ opt }}">{{ opt }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        {% elif question.type_data = 'text' %}
                            <div class="form-group col-md-12{% if question.is_required %} form-required{% endif %}">
                            <label class="control-label" for="{{ q_name }}">
                                {% if question.is_required %}
                                <strong>{{ question.name }}</strong>
                                {% else %}{{ question.name }}
                                {% endif %}
                            </label>
                            <textarea class="form-control" rows="3" name="q_resp-{{ question.pk }}" id="q_resp-{{ question.pk }}" {% if question.is_required %}required{% endif %}></textarea>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <h4>
                            {% trans 'Details' %}
                        </h4>
                    </div>
                    <div class="col-md-12">
                        <div id="detail_empty_form" style="display: none" class="row">
                            <div data-toggle="collapse" data-target="#{{ detail_deadline.empty_form.prefix }}-f"
                                 class="accordion-toggle col-md-10">
                                <div id="{{detail_deadline.empty_form.name.html_name}}-label">
                                    {% trans '(Empty)' as name_value %}
                                    {{ detail_deadline.empty_form.name.value|default_if_none:name_value }}
                                </div>
                            </div>
                            <div class="accordian-body collapse" id="{{ detail_deadline.empty_form.prefix }}-f">
                                {% for field in detail_deadline.empty_form %}
                                    <div class="col-md-4">
                                        {% bootstrap_field field %}
                                    </div>
                                {% endfor %}
                                <div class="col-md-12">
                                    <button data-toggle="collapse" data-target="#{{ detail_deadline.empty_form.prefix }}-f"
                                            type="button" class="btn btn-info accordion-toggle save-detail"
                                            updatelabel="{{ detail_deadline.empty_form.name.html_name }}">
                                        {% trans 'Save' %}
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="detail_deadline">
                            {% for form in detail_deadline.forms %}
                                <div class="row" id="{{ form.prefix }}-row">
                                    <div data-toggle="collapse" data-target="#{{ form.prefix }}-f"
                                         class="accordion-toggle col-md-10">
                                        <div id="{{form.name.html_name}}-label">
                                            {% trans '(Empty)' as name_value %}
                                            {{ form.name.value|default_if_none:name_value }}
                                        </div>
                                    </div>
                                    <div class="accordian-body collapse {% if not buyer.pk %} in {% endif %}" id="{{ form.prefix }}-f">
                                        {% for field in form %}
                                            <div class="col-md-4">
                                                {% bootstrap_field field %}
                                            </div>
                                        {% endfor %}
                                        <div class="col-md-12">
                                            <button data-toggle="collapse" data-target="#{{ form.prefix }}-f"
                                                    type="button" class="btn btn-info accordion-toggle save-detail"
                                                    updatelabel="{{ form.name.html_name }}">
                                                {% trans 'Save' %}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        {{ detail_deadline.management_form }}
                    </div>
                </div>
            </div>
        {% endif %}

        <h3>{% trans 'Attachements' %}</h3>
        <div class="well">
            <div class="thumbnail col-md-3" style="display: none" id="file_empty_form">
                <div class="caption">
                    {% bootstrap_field filedeadline.empty_form.file_type %}
                    {% bootstrap_field filedeadline.empty_form.document layout="inline"%}
                </div>
            </div>
            {{ filedeadline.management_form }}
            <div id="filedeadline_formset">
                <div class="row">
                    {% for f in filedeadline %}
                        <div class="thumbnail col-md-3" id="{{ f.prefix }}-row">
                            <div class="caption">
                                {# {% if f.file_type %} #}
                                    {# <h3>{{ f.file_type.value }}</h3> #}
                                {# {% else %} #}
                                    {% bootstrap_field f.file_type %}
                                {# {% endif %} #}

                                {% if f.document %}
                                    {{ f.document }}
                                    {# <a href="{{ f.document.url }}" target="_blank"><span class="fa fa-file-o"></span></a> #}
                                {% else %}
                                    {% bootstrap_field filedeadline.empty_form.document layout="inline" %}
                                {% endif %}
                            </div>
                        </div>
                    {% empty %}
                        <div class="thumbnail" style="display:none"></div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="well">
            <div class="col-md-6">{% trans "Status" %}:{{ status_deadline }}</div>
            <div class="col-md-6">{% trans "New Status" %}:</div>
        </div>
        <div class="row">
            <div class="col-md-12">
                {% trans 'Save' as save_text %}
                {% bootstrap_button save_text button_type="submit" button_class="btn-success pull-right" icon="ok" %}
                {% url 'index_view' as href_cancel_btn %}
                {% trans 'Cancel' as cancel_text %}
                {% bootstrap_button cancel_text href=href_cancel_btn button_class="btn-danger pull-left" icon="remove" %}
            </div>
        </div>
    </form>
{% endblock %}